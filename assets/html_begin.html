<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!--
  ~ Copyright (C) 2012. Rayman Zhang <raymanzhang@gmail.com>
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, version 3 of the License.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->


<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
    <meta name="viewport" content="width=device-width, initial-scale=$initial_scale$, maximum-scale=5.0" />

    $extra_header$
    <style type="text/css">
        $css$
    </style>
<script>
<!--

$jscode$

-->

<!--

//alex20121205.sn
String.prototype.endsWith = function(str) {
	return (this.match(str + "$") == str)
}
//alex20121205.en
var expand_single=$expand_single$;
var fixed_dict_title = $fixed_dict_title$; //alex20121207.n
function hasClass(ele,cls) {
  return ele.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"));
}
function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp("(\\s|^)"+cls+"(\\s|$)");
    ele.className=ele.className.replace(reg," ");
  }
}

function FixIFrameSrc(elem){
    if ( elem.tagName=='IFRAME' && ( elem.src==null || elem.src=="" )){
        elem.src=elem.attributes["src1"].value;
    }
}
function ToggleShow(titleEle, elemId, arrowId){
	try
	{
	    var elem = document.getElementById(elemId);
	    var arrow = document.getElementById(arrowId)
	
	    //var visible= (elem.className == "__mdx_dict_block_collapse");//alex20121205.o
	    //alex20121205.sn
	    var visible= (elem.className == "__mdx_dict_block_collapse" 
				|| elem.className == "__mdx_dict_block_collapse_alt"  
				|| (titleEle.className.endsWith("_fixed") && !titleEle.isCurrentDict)); //alex20121205.en
	    if ( visible && expand_single ){
	        ShowAllBlock(false, false, elemId);
	    }
	    if (elem){
	        if ( visible )
	             FixIFrameSrc(elem);
	        //alert("scroll into view:"+elem.offsetLeft+","+elem.offsetTop);
	        //elem.className=visible? "__mdx_dict_block_expand":"__mdx_dict_block_collapse"; //alex20121205.o
	        //alex20121205.sn
	        if(visible)
	            elem.className = elem.className.endsWith("_alt")?"__mdx_dict_block_expand __mdx_dict_block_expand_alt":"__mdx_dict_block_expand";
	        else
	            elem.className = elem.className.endsWith("_alt")?"__mdx_dict_block_collapse_alt":"__mdx_dict_block_collapse"; 
			//alex20121205.en
	        if (visible){
	            elem = document.getElementById(elemId);
	            elem.scrollIntoView(true);
	            //alert("Scroll into view:"+elem);
	            //window.scrollTo(elem.offsetLeft, elem.offsetTop);
	        }
	    }
	    if (arrow)
	        arrow.src=visible?"content://mdict.cn/res/arrow_down.png":"content://mdict.cn/res/arrow_up.png";
	    adjustDictTitle();//alex20121205.n
    }
    catch(e)
    {
    	alert(e.message);
    }
}


function ShowAllBlock(visible, onlyFirstOne, exceptElementId){
  allArrowImgs=document.getElementsByName("__mdx_arrow_img");
  for(i=0; i<allArrowImgs.length; ++i){
    allArrowImgs[i].src=visible?"content://mdict.cn/res/arrow_down.png":"content://mdict.cn/res/arrow_up.png";
    if (onlyFirstOne)
      break;
  }

  allBlockDivs=document.getElementsByName("__mdx_block_div");
  for(i=0; i<allBlockDivs.length; ++i){
    if (allBlockDivs[i].id!=exceptElementId) {
     if(i%2!=0) //alex20121205.sn
		allBlockDivs[i].className=visible?"__mdx_dict_block_expand __mdx_dict_block_expand_alt":"__mdx_dict_block_collapse_alt";
	  else
		allBlockDivs[i].className=visible?"__mdx_dict_block_expand":"__mdx_dict_block_collapse"; //alex20121205.en
      if ( visible )
        FixIFrameSrc(allBlockDivs[i]);
    }
    if (onlyFirstOne)
      break;
  }
   if(visible) //alex20121205.sn
     adjustDictTitle(); //alex20121205.en
}

function SetupMdx(){
    if ( typeof(iframe_mode)=="undefined" || !iframe_mode ) {
        SetupTouchEventListener();
    } else{
        //document.body.style.background='black';
        alert("iframe mode, skip setup eventlistener for top window");
        return;
    }
    alert("setup touch event listener done");
    var expand_all=$start_expand_all$;
    ShowAllBlock(true, !expand_all, "");

    var elements = document.getElementsByClassName("__mdx_block_title");
    for(var i = 0; i < elements.length; i++) {
      var elm = elements[i];
      if(i%2!=0)//alex20121205.sn
	  {
		addClass(elm,"__mdx_block_title_alt");
	  }//alex20121205.en
      elm.addEventListener("touchstart", function(event) {
        addClass(this, "__mdx_block_title_active");event.cancelBubble=true;}, false);
      elm.addEventListener("touchmove", function() {
        removeClass(this, "__mdx_block_title_active");}, false);
      elm.addEventListener("touchend", function() {
        removeClass(this, "__mdx_block_title_active");event.cancelBubble=true;}, false);
      elm.addEventListener("touchcancel", function() {
        removeClass(this, "__mdx_block_title_active");}, false);
    }
    //window.location="content://mdict.cn/notify/PageLoaded";
    //window.MdxDict.onPageComplete();
    //alex20121205.sn
	 window.onscroll=function(oEvent){
		adjustDictTitle();
	}
	//alex20121205.en
    window.MdxDict.onPageComplete();
    resizeImages();
	
}

//alex20121205.sn
function adjustDictTitle()
{
    if(fixed_dict_title==false)
    	return;
	var docBody=document.compatMode!="BackCompat" ? document.documentElement: document.body;
    var allBlockTitles = document.getElementsByName("__mdx_block_dict_title");
    var allBlockDivs =document.getElementsByName("__mdx_block_div");
	var factor=1.0*Initail_window_width/top.window.innerWidth;
	var pageY =  window.pageYOffset|| document.documentElement.scrollTop || document.body.scrollTop;
	pageY = pageY  * factor;
	var foundCurrentDict = false;
	var offsetHeight = 0;
	var contendPaddingTop = 0;
	for(i=0; i<allBlockDivs.length; i++){
		var blockDiv = allBlockDivs[i];
		blockDiv.style.paddingTop = "10px";
		allBlockTitles[i].isCurrentDict = null;
		if(!foundCurrentDict)
		{
			var prevTitleOffsetHeight = (i==0?0:allBlockTitles[i-1].offsetHeight);
			offsetHeight = offsetHeight + (i==0?0:allBlockTitles[i-1].offsetHeight);
			contendPaddingTop = contendPaddingTop + (i==0?0:allBlockTitles[i].offsetHeight);
			pageY = pageY + prevTitleOffsetHeight;
			
			//allBlockTitles[j].style.position = 'fixed';
            addClass(allBlockTitles[i], "__mdx_block_title_fixed");
            allBlockTitles[i].style.top = offsetHeight + 'px';
		}
		else
		{
		    allBlockTitles[i].style.top = null;
            removeClass(allBlockTitles[i], "__mdx_block_title_fixed");
		}
		
		var divOffsetTop = getElementTop(blockDiv);
		var divOffsetBottom = (parseInt(getElementTop(blockDiv),10) + parseInt(blockDiv.offsetHeight,10));
		if(pageY >= divOffsetTop && pageY <= divOffsetBottom && !foundCurrentDict && !(blockDiv.className == "__mdx_dict_block_collapse" || blockDiv.className == "__mdx_dict_block_collapse_alt"))
		{
			foundCurrentDict = true;
			allBlockTitles[i].isCurrentDict = "true";
			blockDiv.style.paddingTop = (contendPaddingTop + 50) + "px";
		}
	}
}

function resizeImages() {
	   if(screen.width >= 1024 || screen.height >=1024)
	   {
			var w = top.window.innerWidth - 40;
			for ( var i = 0; i < document.images.length; i++) {
				var img = document.images[i];
				img.style.maxWidth="90%";
				img.style.maxHeight="50%";
				//if (img.width > w) {
				//	img.height = Math.round(img.height * (w / img.width));
				//	img.width = w;
				//}
			}
		}
}
	
function getElementTop(element){
		var actualTop = element.offsetTop;
		var current = element.offsetParent;
		while (current !== null){
			actualTop += current.offsetTop;
			current = current.offsetParent;
		}
		return actualTop;
}
//alex20121205.en
-->
</script>
    <style type="text/css" media="screen">
        html, body{
        height: 100%;
        }

        body {
        margin: 0;
        padding: 0;
        }
    </style>
<style>

    .__mdx_btn {
      font-size: 1em;
      line-height: normal;
      margin-left: 8px;
      margin-right: 8px;

      padding: 4px 10px 4px 10px;
      border-radius: 6px;
      background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#ececec), to(#d6d6d6));
      background-image: -webkit-linear-gradient(top, #ececec, #d6d6d6);
      text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
      border-color: #C43C35 #C43C35 #882A25;
      border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
    }
   .__mdx_block_title {
        border-bottom: #ccc;
        margin: 0px 0px 0px 0px;
        background-color: #24acd6;
        width: 100%;
        word-break: break-all;
        position: relative !important;
    }

    .__mdx_block_title_alt {
        background-color: #a0c93a;
    }

    .__mdx_block_title_fixed {
        position: fixed !important;
        z-index: 999 !important;
        left: 0;
        width: 100%;
    }
    .__mdx_block_title_active {

    }
    .__mdx_dict_block_expand {
        display: block;
        position: relative;
        padding: 10px;
        margin: 0px 0px 0px 0px;
        overflow-x:hidden;
        background-color: #fff;
        border-style: none solid solid solid;
        border-width: 3px;
        border-color: #24acd6;
    }

    .__mdx_dict_block_expand_alt {
        border-color: #a0c93a;
    }

    .__mdx_dict_block_collapse {
        display: none;
        
    }
     .__mdx_dict_block_collapse_alt {
        display: none;
        
    }
</style>
</head>
<body onload="javascript:SetupMdx();" style="margin:0px;padding:0px;">

